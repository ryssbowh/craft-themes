"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}"undefined"===_typeof(Craft.Themes)&&(Craft.Themes={}),Craft.Themes.Blocks=Garnish.Base.extend({$blocks:null,$targetRegions:null,$regions:null,isSaving:!1,init:function(){this.$blocks=$("#theme-blocks .region-blocks .block, #theme-blocks .theme-sidebar .block"),this.$targetRegions=$("#theme-blocks .region-blocks"),this.$regions=$("#theme-blocks .region");var t=this;$.each(this.$targetRegions.find(".block"),function(e){t._initEvents($(e))}),this.blockDragDrop=new Garnish.DragDrop({dropTargets:this.$targetRegions,activeDropTargetClass:"drop-active",helperOpacity:.75,helperBaseZindex:800,onDragStop:$.proxy(this,"_onDragStop"),helper:$.proxy(function(e){return this._getFileDragHelper(e)},this)}),this.blockDragDrop.addItems(this.$blocks),$("#theme-blocks .theme-sidebar h3").click(function(){$(this).next().slideToggle("fast"),$(this).toggleClass("closed")}),$("#toolbar .submit").click(function(e){e.preventDefault(),t.isSaving||t._save($(this))})},_save:function(e){var t=this;this.isSaving=!0;var r={regions:{}};$.each(this.$regions,function(e,t){var o=$(t).data("handle"),i=[];$.each($(t).find(".block"),function(e,t){i.push({blockHandle:$(t).data("handle"),region:o,blockProvider:$(t).data("provider"),active:$(t).find(".lightswitch").hasClass("on"),order:e})}),r.regions[o]=i}),Craft.sendActionRequest("POST",e.attr("href"),{data:r}).then(function(e){console.log(e)}).catch(function(e){Craft.cp.displayError(e)}).finally(function(e){t.isSaving=!1,Craft.cp.displayNotice(e.message),t.populateBlockIds(e.layout)})},_initEvents:function(e){var t=this;e.find(".delete").click(function(){t.blockDragDrop.removeItems(e),e.remove()}),Craft.initUiElements(e),e.find(".lightswitch").change(function(){e.toggleClass("disabled")})},_getFileDragHelper:function(e){var t=$('<div class="theme-block-drap-helper"/>').appendTo(Garnish.$bod);return e.clone().appendTo(t),t},_onDragStop:function(e){var t;this.blockDragDrop.$dropTargets&&this.blockDragDrop.$activeDropTarget?((t=this.blockDragDrop.$draggee).hasClass("original")&&(t=t.clone().removeClass("original"),this.blockDragDrop.addItems(t),this._initEvents(t)),this.blockDragDrop.$activeDropTarget.removeClass(this.blockDragDrop.settings.activeDropTargetClass),this.blockDragDrop.$activeDropTarget.append(t),this.blockDragDrop.fadeOutHelpers(),t.css("visibility","visible")):this.blockDragDrop.returnHelpersToDraggees()}}),$(function(){new Craft.Themes.Blocks});