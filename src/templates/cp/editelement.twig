{% set canEditBlocks = currentUser.can('manageThemesBlocks') %}
{% set canEditDisplays = currentUser.can('manageThemesDisplays') %}
{% set hasTopMargin = hasTopMargin ?? false %}
{% set showBlocks = showBlocks ?? true %}

{% if canEditDisplays or canEditBlocks %}
    {% do craft.app.view.registerAssetBundle('Ryssbowh\\CraftThemes\\assets\\ElementsAssets') %}
    <div id="theme-details"{{ hasTopMargin ? 'class="top-margin"' }}>
        {% for theme in craft.themes.registry.nonPartials %}
            {% set layout = element.getLayout(theme) %}
            <div class="field">
                <div class="heading">
                    <label>{{ theme.name }}</label>
                </div>
                <div class="input ltr flex">
                    {% if canEditDisplays and layout %}
                        <div class="btngroup">
                            <button type="button" class="btn menubtn" aria-haspopup="listbox" aria-expanded="false">
                                <span>{{ 'Edit displays' }}</span>
                            </button>
                            <div class="menu">
                                <ul class="padded" role="listbox" aria-hidden="true">
                                    {% for viewMode in layout.viewModes %}
                                        <li>
                                            <a href="{{ layout.getEditDisplaysUrl(viewMode) }}" role="option" tabindex="-1">{{ viewMode.name }}</a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    {% endif %}
                    {% if canEditBlocks and showBlocks and layout %}
                        <a class="btn" href="{{ layout.getEditBlocksUrl() }}">
                            <span>{{ 'Edit Blocks'|t('themes') }}</span>
                        </a>
                    {% endif %}
                </div>
        {% endfor %}
    </div>
{% endif %}